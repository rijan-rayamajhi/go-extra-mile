# Bugs Feature - Low Level Design (LLD)

## Metadata

| Field | Value |
|-------|-------|
| **Feature Name** | Bug Reports Management |
| **Version** | 1.0.0 |
| **Last Updated** | December 2024 |
| **Architecture Pattern** | Clean Architecture (Domain-Driven Design) |
| **State Management** | BLoC Pattern |
| **Backend Service** | Firebase Firestore + Firebase Storage |
| **Supported Platforms** | Android, iOS |
| **Dependencies** | cloud_firestore, firebase_storage, flutter_bloc, equatable, dartz |

## Overview

The Bugs feature manages bug reporting and tracking in the Go Extra Mile application. It allows users to submit detailed bug reports with screenshots, track their submission status, and earn rewards for valid bug reports. The feature implements a comprehensive bug management system with admin capabilities for status updates and reward management.

### Key Features
- **Bug Report Submission**: Users can submit detailed bug reports with screenshots
- **Status Tracking**: Real-time tracking of bug report status (Pending, Under Review, In Progress, Fixed, Rejected)
- **Reward System**: Users earn GEM coins for valid bug reports
- **Filtering & Search**: Advanced filtering by status, category, priority, and severity
- **Screenshot Management**: Upload and manage screenshots for bug reports
- **Admin Management**: Admin can update status, add notes, and set rewards
- **Real-time Updates**: Live status updates from Firestore
- **Statistics**: Comprehensive user statistics for bug reports

### Architecture Components
- **Domain Layer**: Entities, repositories, and use cases
- **Data Layer**: Data sources, models, and repository implementations
- **Presentation Layer**: BLoC, screens, and widgets

## Data Models

### 1. BugReportEntity (Domain Entity)
```dart
class BugReportEntity extends Equatable {
  final String id;                    // Unique bug report identifier
  final String userId;               // User who submitted the report
  final String title;                // Bug title
  final String description;          // Detailed bug description
  final String category;             // Bug category (UI/UX, Functionality, etc.)
  final String priority;             // Priority level (Low, Medium, High, Critical)
  final String severity;             // Severity level (Minor, Major, Critical, Blocker)
  final String status;               // Current status (Pending, Under Review, etc.)
  final List<String> screenshots;   // Screenshot URLs
  final String? stepsToReproduce;    // Steps to reproduce the bug
  final String? deviceInfo;          // Device information
  final DateTime createdAt;         // Creation timestamp
  final DateTime? updatedAt;        // Last update timestamp
  final int rewardAmount;           // Reward amount in GEM coins
  final String? adminNotes;         // Admin notes
}
```

**Purpose**: Core bug report data representation in the domain layer
**Properties**:
- `id`: Unique identifier generated by Firestore
- `userId`: Firebase UID of the user who submitted the report
- `title`: Brief description of the bug
- `description`: Detailed explanation of the bug
- `category`: Classification of the bug type
- `priority`: Business priority of the bug
- `severity`: Technical severity of the bug
- `status`: Current workflow status
- `screenshots`: List of screenshot URLs
- `stepsToReproduce`: Optional steps to reproduce the bug
- `deviceInfo`: Optional device/platform information
- `createdAt`: When the report was submitted
- `updatedAt`: When the report was last modified
- `rewardAmount`: GEM coins earned for this report
- `adminNotes`: Admin comments and notes

### 2. BugReportModel (Data Model)
```dart
class BugReportModel extends BugReportEntity {
  // Extends BugReportEntity with serialization methods
  factory BugReportModel.fromEntity(BugReportEntity entity);
  factory BugReportModel.fromJson(Map<String, dynamic> json);
  Map<String, dynamic> toJson();
  Map<String, dynamic> toFirestore();
  factory BugReportModel.fromFirestore(String id, Map<String, dynamic> data);
}
```

**Purpose**: Data layer representation with serialization capabilities
**Features**:
- JSON serialization/deserialization
- Firestore document conversion
- Entity conversion methods

## Domain Layer

### Repository Interface
```dart
abstract class BugReportRepository {
  Future<Either<Failure, BugReportEntity>> submitBugReport(BugReportEntity bugReport);
  Future<Either<Failure, List<BugReportEntity>>> getUserBugReports(String userId);
  Future<Either<Failure, BugReportEntity>> getBugReportById(String bugReportId);
  Future<Either<Failure, BugReportEntity>> updateBugReportStatus(String bugReportId, String status, String? adminNotes);
  Future<Either<Failure, List<BugReportEntity>>> getBugReportsByStatus(String userId, String status);
  Future<Either<Failure, Map<String, dynamic>>> getUserBugReportStats(String userId);
  Future<Either<Failure, void>> deleteBugReport(String bugReportId, String userId);
  Future<Either<Failure, String>> uploadScreenshot(String bugReportId, String imagePath);
  Future<Either<Failure, List<BugReportEntity>>> getAllBugReports();
  Future<Either<Failure, BugReportEntity>> updateBugReportReward(String bugReportId, int rewardAmount);
}
```

### Use Cases
1. **SubmitBugReport**: Validates and submits new bug reports
2. **GetUserBugReports**: Retrieves all bug reports for a specific user
3. **GetBugReportsByStatus**: Filters bug reports by status
4. **GetUserBugReportStats**: Calculates user statistics
5. **UploadBugScreenshot**: Handles screenshot uploads

## Data Layer

### Remote Data Source
```dart
class BugReportRemoteDataSourceImpl implements BugReportRemoteDataSource {
  final FirebaseFirestoreService firestoreService;
  final FirebaseStorageService storageService;
  final FirebaseFirestore firestore;
}
```

**Features**:
- Firestore integration for bug report storage
- Firebase Storage for screenshot uploads
- Real-time data synchronization
- Error handling and validation

### Data Source Architecture
The bugs feature uses only remote data sources for simplicity and real-time updates.

### Repository Implementation
```dart
class BugReportRepositoryImpl implements BugReportRepository {
  final BugReportRemoteDataSource remoteDataSource;
}
```

**Features**:
- Direct remote data source integration
- Error handling and mapping
- Real-time data access

## Presentation Layer

### BLoC State Management
```dart
class BugReportBloc extends Bloc<BugReportEvent, BugReportState> {
  final SubmitBugReport submitBugReport;
  final GetUserBugReports getUserBugReports;
  final GetBugReportsByStatus getBugReportsByStatus;
  final GetUserBugReportStats getUserBugReportStats;
  final UploadBugScreenshot uploadBugScreenshot;
  final BugReportRepository bugReportRepository;
}
```

### Events
- `SubmitBugReportEvent`: Submit a new bug report
- `GetUserBugReportsEvent`: Load user's bug reports
- `GetBugReportsByStatusEvent`: Filter reports by status
- `GetBugReportStatsEvent`: Load user statistics
- `UploadBugScreenshotEvent`: Upload screenshot
- `DeleteBugReportEvent`: Delete a bug report
- `RefreshBugReportsEvent`: Refresh data
- `ClearBugReportStateEvent`: Clear state

### States
- `BugReportInitial`: Initial state
- `BugReportLoading`: Loading state
- `BugReportLoaded`: Data loaded successfully
- `BugReportStatsLoaded`: Statistics loaded
- `BugReportSubmitted`: Report submitted successfully
- `BugReportDeleted`: Report deleted successfully
- `ScreenshotUploaded`: Screenshot uploaded successfully
- `BugReportError`: Error state
- `BugReportSuccess`: Success state

## Screens

### 1. FindAndEarnScreen
**Purpose**: Bug report submission interface
**Features**:
- Form validation
- Category, priority, and severity selection
- Screenshot upload
- Real-time form validation
- Success/error feedback

### 2. BugReportsTrackingScreen
**Purpose**: Track and manage submitted bug reports
**Features**:
- List view of user's bug reports
- Status filtering
- Statistics display
- Detailed report view
- Refresh functionality

## Enums

### BugCategory
```dart
enum BugCategory {
  uiUx('UI/UX'),
  functionality('Functionality'),
  performance('Performance'),
  security('Security'),
  navigation('Navigation'),
  data('Data'),
  other('Other');
}
```

### BugPriority
```dart
enum BugPriority {
  low('Low'),
  medium('Medium'),
  high('High'),
  critical('Critical');
}
```

### BugSeverity
```dart
enum BugSeverity {
  minor('Minor'),
  major('Major'),
  critical('Critical'),
  blocker('Blocker');
}
```

### BugStatus
```dart
enum BugStatus {
  pending('Pending'),
  underReview('Under Review'),
  inProgress('In Progress'),
  fixed('Fixed'),
  rejected('Rejected'),
  duplicate('Duplicate');
}
```

## Database Schema

### Firestore Collection: `bug_reports`
```json
{
  "id": "string",
  "userId": "string",
  "title": "string",
  "description": "string",
  "category": "string",
  "priority": "string",
  "severity": "string",
  "status": "string",
  "screenshots": ["string"],
  "stepsToReproduce": "string?",
  "deviceInfo": "string?",
  "createdAt": "timestamp",
  "updatedAt": "timestamp?",
  "rewardAmount": "number",
  "adminNotes": "string?"
}
```

### Firebase Storage Structure
```
bug_reports/
  {bugReportId}/
    screenshot_{timestamp}.jpg
    screenshot_{timestamp}.jpg
    ...
```

## Error Handling

### Custom Exceptions
- `ServerException`: Remote data source errors
- `ValidationFailure`: Input validation errors
- `CacheException`: Local storage errors

### Error States
- Network connectivity issues
- Authentication failures
- Permission errors
- Data validation errors
- Storage quota exceeded

## Performance Considerations

### Optimization
- Lazy loading of bug reports
- Image compression for screenshots
- Pagination for large datasets
- Real-time updates from Firestore

## Security

### Data Protection
- User authentication required for all operations
- User can only access their own bug reports
- Admin-only operations for status updates
- Secure file upload with validation

### Validation
- Input sanitization
- File type validation for screenshots
- Size limits for uploads
- Rate limiting for submissions

## Testing Strategy

### Unit Tests
- Use case testing
- Repository testing
- BLoC testing
- Model testing

### Integration Tests
- Data source testing
- Repository integration
- End-to-end workflows

### Widget Tests
- Screen component testing
- Form validation testing
- User interaction testing

## Future Enhancements

### Planned Features
- Push notifications for status updates
- Bug report templates
- Advanced search and filtering
- Admin dashboard
- Bug report analytics
- Integration with issue tracking systems
- Automated reward distribution
- Bug report voting system
- Duplicate detection
- Bug report categories customization

### Technical Improvements
- Real-time updates with Firestore listeners
- Advanced caching strategies
- Offline-first architecture
- Performance monitoring
- Analytics integration
- A/B testing for reward systems

## Dependencies

### Core Dependencies
- `flutter_bloc`: State management
- `equatable`: Value equality
- `dartz`: Functional programming
- `cloud_firestore`: Database
- `firebase_storage`: File storage
- `firebase_auth`: Authentication

### Development Dependencies
- `mockito`: Testing
- `bloc_test`: BLoC testing
- `integration_test`: Integration testing

## API Integration

### Firebase Services
- **Firestore**: Primary database for bug reports
- **Storage**: Screenshot file storage
- **Auth**: User authentication and authorization

### Data Flow
1. User submits bug report → Validation → Firestore
2. Screenshots uploaded → Firebase Storage → URLs stored in Firestore
3. Admin updates status → Firestore → Real-time sync to users
4. Statistics calculated → Cached locally → Displayed to user

## Monitoring and Analytics

### Key Metrics
- Bug report submission rate
- Average resolution time
- User engagement with bug reporting
- Reward distribution effectiveness
- Category distribution of bugs

### Error Tracking
- Failed submissions
- Upload failures
- Network errors
- Authentication issues

## Deployment Considerations

### Environment Configuration
- Firebase project configuration
- Storage bucket setup
- Security rules configuration
- Firestore indexes

### Performance Monitoring
- Database query performance
- Storage usage monitoring
- User experience metrics
- Error rate tracking
